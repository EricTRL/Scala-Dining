{% extends 'accounts/associations_base.html' %}

{% block tab_invoicing %}active{% endblock %}

{% block details %}
    <p>
        Diners in your association can upgrade their balance using invoicing.
        Your association is responsible for actually invoicing your members!
        This page allows you to create reports with the amounts to invoice.
    </p>

    <p>
        There are currently <strong>{{ unreported.count }}</strong> new transactions which haven't been invoiced yet.
        Click the button below to create a new report with these transactions.
    </p>
    <form action="{% url 'invoicing-reports' association_name=association.slug %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary" {% if unreported.count == 0 %}disabled{% endif %}>
            Create invoice report
        </button>
    </form>
    <h4 class="mt-3">Invoice reports</h4>
    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col">Period</th>
            <th scope="col">Nr. of transactions</th>
            <th scope="col">Download</th>
        </tr>
        </thead>
        <tbody>
        {% for report in reports %}
            <tr class="position-relative">
                {# Time is omitted here for clarity #}
                <td>
                    {{ report.oldest|date:"SHORT_DATE_FORMAT" }}
                    â€“ {{ report.newest|date:"SHORT_DATE_FORMAT" }}
                </td>
                <td>{{ report.transactions.count }}</td>
                <td>
                    <a href="{% url 'invoicing-report-download' pk=report.pk %}" class="stretched-link">
                        Download report
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
